# windows, get python path
(Get-Command python).Source

# windows
./.venv/Scripts/Activate.ps1

===

python ttf/dump_data_yaml.py input/NotoSansMonoCJKhk-VF.ttf output/NotoSansMonoCJKhk-VF.data.yaml
python ttf/dump_data_yaml.py output/CodeCJK002_20251229000015.ttf output/CodeCJK002_20251229000015.data.yaml

python ttf/dump_char_csv.py input/JetBrainsMonoNL-Regular.ttf output/JetBrainsMonoNL-Regular.char.csv
python ttf/dump_char_csv.py input/NotoSansMonoCJKhk-VF.ttf output/NotoSansMonoCJKhk-VF.char.csv

python ttf/filter_char_csv.py output/JetBrainsMonoNL-Regular.char.csv  ascii output/JetBrainsMonoNL-Regular.ascii.csv
python ttf/filter_char_csv.py output/JetBrainsMonoNL-Regular.char.csv  upper,number output/JetBrainsMonoNL-Regular.big.csv
python ttf/filter_char_csv.py output/NotoSansMonoCJKhk-VF.char.csv common_cjk output/NotoSansMonoCJKhk-VF.ccjk.csv

python ttf/list_extreme_y.py output/JetBrainsMonoNL-Regular.ascii.csv output/JetBrainsMonoNL-Regular.ascii.extremey.csv
python ttf/list_extreme_y.py output/NotoSansMonoCJKhk-VF.cjk.csv  output/NotoSansMonoCJKhk-VF.cjk.extremey.csv

# $@g宺ざ퓠퀐

python ttf/cal_shift_y.py output/JetBrainsMonoNL-Regular.big.csv output/NotoSansMonoCJKhk-VF.ccjk.csv output/shift.yaml

python ttf/font_shift_y.py input/NotoSansMonoCJKhk-VF.ttf output/shift.yaml output/cjk.ttf

python ttf/dump_char_csv.py output/cjk.ttf output/cjk.char.csv

python ttf/pick_font.py output/JetBrainsMonoNL-Regular.char.csv,output/cjk.char.csv output/pick.char.csv

python ttf/cal_meta.py output/JetBrainsMonoNL-Regular.ascii.csv output/JetBrainsMonoNL-Regular.big.csv output/pick.meta.yaml

# python ttf/merge_font.py input/JetBrainsMonoNL-Regular.ttf output/cjk.ttf output/pick.char.csv output/pick.meta.yaml --output output/test.ttf
python ttf/merge_font.py input/JetBrainsMonoNL-Regular.ttf,output/cjk.ttf output/pick.char.csv output/pick.meta.yaml --output output/test.ttf

python ttf/dump_data_yaml.py output/test.ttf output/test.data.yaml

python font_preview.py output/test.ttf "$@g宺ざ퓠퀐" output/test --debug
python font_preview.py output/test.ttf "你好 0O1Il| ()jy宺ざ퓠퀐" output/test --debug
python font_preview.py output/test.ttf "你好 0O1Il| ()jy宺ざ퓠퀐" output/test

python ttf/merge_font.py input/JetBrainsMonoNL-Regular.ttf,output/cjk.ttf output/pick.char.csv output/pick.meta.yaml

python ttf/merge_font.py input/JetBrainsMonoNL-Regular.ttf,output/cjk.ttf output/pick.char.csv output/pick.meta.yaml --output output/test.ttf

python ttf/csv_compare_box.py output\pick.char.csv output\test.char.csv

python ttf/csv_compare_box.py output\pick.char.csv output\test.char.csv

python ttf/check_mono_width.py output\test.ttf

===

python monomerge.py -l input/consola.ttf -c input/NotoSansMonoCJKhk-Regular.otf --cjk-y-offset=-81 -o output/test.ttf

python font_preview.py output/test.ttf "你好嗎 123" output/test --debug

==

python find_extreme_y.py --ascii input/JetBrainsMonoNL-Regular.ttf
# jy() -174.0 735.0

python find_extreme_y.py --cjk input/NotoSansMonoCJKhk-Regular.otf
# 퓠宺 -107.0 827.0

python monomerge.py -l input/JetBrainsMonoNL-Regular.ttf -c input/NotoSansMonoCJKhk-Regular.otf -o output/test.ttf
python font_preview.py output/test.ttf "jy()퓠宺" output/test --debug

===

python ttf/merge_font.py input/JetBrainsMonoNL-Regular.ttf,output/cjk.ttf output/pick.char.csv output/pick.meta.yaml --vendor-id LUZI --font-name CodeCJK003 --output output/CodeCJK003_DATETIME.ttf

===

create a new python main script ttf/cal_meta.py

* args:
  * input_font_csv: a csv file created by ttf/dump_char_csv.py, take output/JetBrainsMonoNL-Regular.ascii.csv as example
  * output_yaml: a yaml file contains the calculated meta data
* output yaml:
  * half_advance_width: the advance_width of common half width char
  * full_advance_width: the advance_width of full width char, must be half_advance_width * 2
  * min_yMin / max_yMax
  * char_height: max_yMax-min_yMin
  * font_height: char_height*1.2
  * ascender / descender: based on font_height, min_yMin, max_yMax.  ascender extend 60%, descender extend 40%.

===

Create main script ttf/merge_font.py

* args:
  * input_ttf_list: a input ttf file list, seperated by comma, e.g. input/JetBrainsMonoNL-Regular.ttf,output/cjk.ttf
  * input_pick_csv: a csv file created by ttf/pick_font.py, take output/pick.char.csv as example
  * input_meta_yaml: a yaml file created by ttf/cal_meta.py, take output/pick.meta.yaml as example
  * vendor_id: os/2 vendor id
    * if not given, use MOME
  * font_name: the name of the font
    * if not given, use test{yyyymmddhhmmss}
  * output_ttf: the output ttf file
    * if not given, use output/test{yyyymmddhhmmss}.ttf
* create a new ttf file output_ttf, combine ttf in input_ttf_list
* the new ttf should be a new ttf instance from fonttools
* input_pick_csv pick column decide which ttf to be used on the char, 0=first, 1=second, etc
* for is_full_width is true, advance width should be full_advance_width in input_meta_yaml, otherwise half_advance_width
* mark the font as monospace, take monomerge.py as reference.
* update unicode support range table
* ascender and descender follow input_meta_yaml
* version is {yyyymmddhhmmss}
* for all other information meta data, just put "created by MonoMerge"

===

create a new python main script ttf/dump_data_yaml.py
* input args
  * input_ttf: the ttf file to inspect
  * output_ymal: the font data yaml
* dump as much data/metadata as much as it can
* do not dump per characters data

python ttf/dump_data_yaml.py input/JetBrainsMonoNL-Regular.ttf output/JetBrainsMonoNL-Regular.data.yaml
python ttf/dump_data_yaml.py input/mingliu.ttc --font-index=0 output/mingliu-0.data.yaml
python ttf/dump_data_yaml.py output/test.ttf output/test.data.yaml

===

Created a new font using:

python ttf/merge_font.py input/JetBrainsMonoNL-Regular.ttf output/cjk.ttf output/pick.char.csv output/pick.meta.yaml --output output/test.ttf

But in dp4 font viewer, the advance of full width char are half width, not full width.

font data can be dump by:
python ttf/dump_data_yaml.py input/mingliu.ttc --font-index=0 output/mingliu-0.data.yaml
python ttf/dump_data_yaml.py output/test.ttf output/test.data.yaml
python ttf/dump_data_yaml.py output/CodeCJK002_20251229000015.ttf output/codecjk.data.yaml

Compare output/test.data.yaml and output/mingliu-0.data.yaml, check the reason why the full width char in output/test.ttf only advance in half width, and fix.

The script ttf/dump_data_yaml.py can be modified to dump more data if you need.

Moreover, output/CodeCJK002_20251229000015.ttf is created by following command:

python3 monomerge.py -l input/consola.ttf -c input/NotoSansMonoCJKhk-Regular.otf --cjk-y-offset=-81 -o output/CodeCJK_DATETIME.ttf -n CodeCJK

And it display ok in dp4.
I guess there is some meta data from input/NotoSansMonoCJKhk-Regular.otf which make the font advance well.


===

some more fact may useful for debug
The font file output/CodeCJK002_20251229000015.ttf is created via following command:

python3 monomerge.py -l input/consola.ttf -c input/NotoSansMonoCJKhk-Regular.otf --cjk-y-offset=-81 -o output/CodeCJK_DATETIME.ttf -n CodeCJK

And it display ok in dp4.
I guess there is some meta data from input/NotoSansMonoCJKhk-Regular.otf which make the font advance well.

===

Change ttf/pick_font.py:
* args:
  * input_csv_list: list of input font csv, seperated by comma, generated by dump_char_csv.py. e.g "output/JetBrainsMonoNL-Regular.char.csv,output/cjk.char.csv"
  * output_csv: no Change
* logic: for all char data in each csv:
  * if char exist in first csv, and (advance_width>0), and not is_empty_glyph. if yes, pick first csv as the char font
  * else, check if second csv match the condition. if yes, pick second csv
  * keep try third and forth csv.
  * if none of csv match, check if char exist in first csv, no need to check advance_width and is_empty_glyph. if yes, pick first csv as the char font.
  * else, check the second, third, forth csv.
* Assume the input csv files is sorted by codepoint_dec
* The output csv should also sorted by codepoint_dec
* Avoid loading whole csv data into memory
* Create new column "pick", first=0, second=1...

===

Create a new python script ttf/remove_table.py

* args:
  * input_ttf: the input ttf file
  * output_ttf: the output ttf file
* Remove GPOS and GSUB tables from the ttf file

python ttf/remove_table.py output/CodeCJK002_20251229000015.ttf output/tmp.ttf

===

A font file is generated by following command

python ttf/merge_font.py input/JetBrainsMonoNL-Regular.ttf,output/cjk.ttf output/pick.char.csv output/pick.meta.yaml --output output/test.ttf

The bound of each char is extract from following command

python ttf/dump_char_csv.py output/test.ttf output/test.char.csv

it show that the bar char (U+007C) is from output/cjk.ttf, but it should be from input/JetBrainsMonoNL-Regular.ttf

===

Create a script csv_compare_box.py to compare two csv

* args
  * input_csv_0, input_csv_1: the csv to compare, take output\test.char.csv as example
* for each codepoint_dec, compare the advance_width,lsb,xMin,yMin,xMax,yMax,width,height,is_full_width,is_empty_glyph,is_composite,num_contours values
* print out if not match
